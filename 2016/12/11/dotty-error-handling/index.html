<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Working with domain-specific errors in Dotty · Yet another programming blog</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">Home</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   Blog</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li><li class="nav-list-item"><a href="https://github.com/vsuharnikov" target="_blank" class="nav-link" rel="external nofollow noopener noreferrer">   github</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2016/12/11/dotty-error-handling/" class="post-title-link">Working with domain-specific errors in Dotty</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/scala/" class="post-tag-link">scala</a></li><li class="post-tag-item"><a href="/tags/dotty/" class="post-tag-link">dotty</a></li><li class="post-tag-item"><a href="/tags/error/" class="post-tag-link">error</a></li></ul><div class="post-time">Sunday, December 11th 2016</div></div><div class="post-content"><p>A short time ago i experimented with <a href="https://github.com/lampepfl/dotty" rel="external nofollow noopener noreferrer" target="_blank">Dotty</a>, the future of Scala.<br>There is an interesting language’s feature: Union types.</p>
<p>For example, we are working on a configuration module and want to distinguish different types of errors:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Error</span></span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Error</span> </span>&#123;</div><div class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">FileNotFound</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">InvalidFormat</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Config</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loadFrom</span></span>(file: <span class="type">File</span>): <span class="type">Either</span>[<span class="type">Error</span>, <span class="type">Config</span>] = ???</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>There also could be exceptions we forgot or don’t want to handle and convert to our errors hierarchy.</p>
<p>Then we add a new error and a method:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Config</span> </span>&#123;</div><div class="line">  <span class="comment">// …</span></div><div class="line">  <span class="class"><span class="keyword">object</span> <span class="title">Error</span> </span>&#123;</div><div class="line">    <span class="comment">// …</span></div><div class="line">    <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">OutOfSpace</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// …</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">saveTo</span></span>(config: <span class="type">Config</span>, file: <span class="type">File</span>): <span class="type">Either</span>[<span class="type">Error</span> <span class="comment">/* ? */</span>, <span class="type">Unit</span>] = ???</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The <em>InvalidFormat</em> error never happens here. But a user doesn’t know it, he have to handle all cases.<br>It’s true for the <em>loadFrom</em> too. </p>
<p>We could create another hierarchy of errors for <em>saveTo</em>, but this way is too bulky.</p>
<p>This issue is solved by the Dotty and its Union types:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Error</span></span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Error</span> </span>&#123;</div><div class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">FileNotFound</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">InvalidFormat</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line"></div><div class="line">  <span class="comment">// A new error</span></div><div class="line">  <span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">OutOfSpace</span> <span class="keyword">extends</span> <span class="title">Error</span></span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Config</span> </span>&#123;</div><div class="line">  <span class="comment">// Only two errors of three can happen</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loadFrom</span></span>(file: <span class="type">File</span>): <span class="type">Either</span>[<span class="type">Error</span>.<span class="type">FileNotFound</span> | <span class="type">Error</span>.<span class="type">InvalidFormat</span>, <span class="type">Config</span>] = ???</div><div class="line"></div><div class="line">  <span class="comment">// Only the one error</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">saveTo</span></span>(config: <span class="type">Config</span>, file: <span class="type">File</span>): <span class="type">Either</span>[<span class="type">Error</span>.<span class="type">OutOfSpace</span>, <span class="type">Unit</span>] = ???</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>It is straightforward to combine these methods in a for-comprehension and get the right type:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// The type is Either[Error.FileNotFound | Error.InvalidFormat | Error.OutOfSpace, Unit]</span></div><div class="line"><span class="keyword">val</span> r = <span class="keyword">for</span> &#123;</div><div class="line">  config ← <span class="type">Config</span>.loadFrom(configFile)</div><div class="line">  <span class="comment">// …</span></div><div class="line">  _ ← <span class="type">Config</span>.saveTo(config, configFile)</div><div class="line">&#125; <span class="keyword">yield</span> newConfig</div></pre></td></tr></table></figure></p>
<p>This works too:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">val</span> r: <span class="type">Either</span>[<span class="type">Error</span>, <span class="type">Config</span>] = ??? <span class="comment">// Same code</span></div></pre></td></tr></table></figure></p>
<p>So, with this approach:</p>
<ol>
<li>We see all errors can happen;</li>
<li>The compiler helps you to handle expected errors;</li>
<li>You can easily handle expected errors with the power of a pattern-matching in a way you want;</li>
<li>Errors are joined in for-comprehensions.</li>
</ol>
</div></article><div class="pagination"><a href="/2017/02/26/grepping-logs-without-data-loss/" class="pagination-prev">PREV</a><span class="pagination-next">NEXT</span></div><div class="comments"></div></div><aside class="sidebar"><h3>Tags</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/dotty/">dotty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grep/">grep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logback/">logback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a></li></ul><h3>Posts</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/26/grepping-logs-without-data-loss/">Grepping logs without data loss</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/dotty-error-handling/">Working with domain-specific errors in Dotty</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><p>© 2017 <a href="/">Vyatcheslav Suharnikov</a></p></div><div class="power"><p><a rel="external nofollow noopener noreferrer" href="http://pinggod.com/" target="_blank">Sean Sun</a>, 
<a rel="external nofollow noopener noreferrer" href="https://hexo.io" target="_blank">Hexo</a>, 
<a rel="external nofollow noopener noreferrer" href="https://github.com/" target="_blank">GitHub</a>, 
<a rel="external nofollow noopener noreferrer" href="https://jekyllrb.com/" target="_blank">Jekyll</a></p></div></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>