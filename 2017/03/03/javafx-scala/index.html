<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Working with JavaFX in Scala · Yet another programming blog</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/jekyll.css"><!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--></head><body><header class="row-flex-row limit-width vh-center"><a href="/" class="logo"><img src="/favicon.png"></a><nav><ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-link">Home</a></li><li class="nav-list-item"><a href="/archives/" class="nav-link active">   Blog</a></li><li class="nav-list-item"><a href="/atom.xml" class="nav-link">rss</a></li><li class="nav-list-item"><a href="https://github.com/vsuharnikov" target="_blank" class="nav-link" rel="external nofollow noopener noreferrer">   github</a></li></ul></nav></header><div class="container limit-width"><section class="row-flex-row"><div class="post"><article class="post-block"><h2 class="post-title"><a href="/2017/03/03/javafx-scala/" class="post-title-link">Working with JavaFX in Scala</a></h2><div class="post-meta"><ul class="post-tag-list"><li class="post-tag-item"><a href="/tags/scala/" class="post-tag-link">scala</a></li><li class="post-tag-item"><a href="/tags/javafx/" class="post-tag-link">javafx</a></li></ul><div class="post-time">Friday, March 3rd 2017</div></div><div class="post-content"><p>I’m working on a prototype of the GUI application, that helps me to be more productive. </p>
<p>At first i tried <a href="http://www.scalafx.org" rel="external nofollow noopener noreferrer" target="_blank">ScalaFX</a>, but faced with several problems (especially with the TableView).<br>So, i switched to the JavaFX and implemented all functionality two or three times faster.</p>
<p>JavaFX and Scala 2.12 are working together perfectly, thanks to the <a href="http://www.scala-lang.org/news/2.12.0#lambda-syntax-for-sam-types" rel="external nofollow noopener noreferrer" target="_blank">SAM</a>.<br>But there is a subtle problem. </p>
<p>Let’s look on an example:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavaCustomControl</span> <span class="keyword">extends</span> <span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="meta">@FXML</span></div><div class="line">  <span class="keyword">private</span> TextField textField;</div><div class="line"></div><div class="line">  <span class="comment">// It could be any inner class</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Runnable f = <span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">      System.out.println(textField);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">  </div><div class="line">  <span class="comment">// Load a template by FXMLLoader in the constructor</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>You could write an equivalent in Scala in the following way:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalaCustomControl</span> <span class="keyword">extends</span> <span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="meta">@FXML</span> <span class="keyword">private</span> <span class="keyword">var</span> textField: <span class="type">TextField</span> = _</div><div class="line"></div><div class="line">  <span class="comment">// It might be any inner class</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">val</span> f: <span class="type">Runnable</span> = <span class="keyword">new</span> <span class="type">Runnable</span>() &#123;</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>() &#123;</div><div class="line">      <span class="type">System</span>.out.println(textField)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// Load a template by FXMLLoader in the constructor</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Welcome to the trap! The <code>textField</code> will be null after the <code>FXMLLoader.load</code>, because the byte code for these two example are different.</p>
<p>Let’s use <code>:javap -private</code> on these classes:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span>.<span class="title">JavaCustomControl</span> <span class="keyword">extends</span> <span class="title">javafx</span>.<span class="title">scene</span>.<span class="title">layout</span>.<span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> javafx.scene.control.TextField textField;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> java.lang.Runnable f;</div><div class="line">  <span class="keyword">public</span> test.JavaCustomControl();</div><div class="line">  <span class="keyword">static</span> javafx.scene.control.TextField access$<span class="number">000</span>(test.JavaCustomControl);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>vs:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span>.<span class="title">ScalaCustomControl</span> <span class="keyword">extends</span> <span class="title">javafx</span>.<span class="title">scene</span>.<span class="title">layout</span>.<span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> javafx.scene.control.TextField test$ScalaCustomControl$$textField;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> java.lang.Runnable f;</div><div class="line">  <span class="keyword">public</span> javafx.scene.control.TextField test$ScalaCustomControl$$textField();</div><div class="line">  <span class="keyword">private</span> java.lang.<span class="function">Runnable <span class="title">f</span><span class="params">()</span></span>;</div><div class="line">  <span class="keyword">public</span> test.ScalaCustomControl();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>As you see, the Scala’s compiler mangle the <code>textField</code> variable.</p>
<p>How could you fix it? The only way is to make the <code>textField</code> public:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalaCustomControl</span> <span class="keyword">extends</span> <span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="meta">@FXML</span> <span class="keyword">var</span> textField: <span class="type">TextField</span> = _</div><div class="line">  <span class="comment">// …</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Now the name isn’t mangled:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">test</span>.<span class="title">ScalaCustomControl</span> <span class="keyword">extends</span> <span class="title">javafx</span>.<span class="title">scene</span>.<span class="title">layout</span>.<span class="title">VBox</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> javafx.scene.control.<span class="type">TextField</span> textField;</div></pre></td></tr></table></figure></p>
</div></article><div class="pagination"><span class="pagination-prev">PREV</span><a href="/2017/02/26/grepping-logs-without-data-loss/" class="pagination-next">NEXT</a></div><div class="comments"></div></div><aside class="sidebar"><h3>Tags</h3><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/dotty/">dotty</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/error/">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grep/">grep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javafx/">javafx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logback/">logback</a></li></ul><h3>Posts</h3><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/javafx-scala/">Working with JavaFX in Scala</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/26/grepping-logs-without-data-loss/">Grepping logs without data loss</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/dotty-error-handling/">Working with domain-specific errors in Dotty</a></li></ul></aside></section></div><div class="extra"></div><footer class="footer"><div class="row-flex-row limit-width vh-center"><div class="copyright"><p>© 2017 <a href="/">Vyatcheslav Suharnikov</a></p></div><div class="power"><p><a rel="external nofollow noopener noreferrer" href="http://pinggod.com/" target="_blank">Sean Sun</a>, 
<a rel="external nofollow noopener noreferrer" href="https://hexo.io" target="_blank">Hexo</a>, 
<a rel="external nofollow noopener noreferrer" href="https://github.com/" target="_blank">GitHub</a>, 
<a rel="external nofollow noopener noreferrer" href="https://jekyllrb.com/" target="_blank">Jekyll</a></p></div></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>